<!-- Add this modal after the resolveEscalationModal -->

<!-- Reject Escalation Modal -->
<div id="rejectEscalationModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-medium leading-6 text-gray-900">Reject Escalation Request</h3>
                <button onclick="closeRejectEscalationModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="mt-2">
                <label for="rejectEscalationNotesTextarea" class="block text-sm font-medium text-gray-700 mb-2">
                    Rejection Reason <span class="text-red-600">*</span>
                </label>
                <textarea id="rejectEscalationNotesTextarea" rows="4" 
                          class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-red-500"
                          placeholder="Enter reason for rejection..." required></textarea>
            </div>
            <div class="flex gap-3 mt-4">
                <button id="confirmRejectEscalation" type="button" 
                        class="flex-1 px-4 py-2 bg-red-600 text-white text-base font-medium rounded-md shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                    Reject Escalation
                </button>
                <button onclick="closeRejectEscalationModal()" type="button"
                        class="flex-1 px-4 py-2 bg-gray-300 text-gray-700 text-base font-medium rounded-md shadow-sm hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add these functions in the script -->

    function showRejectEscalationModal(ticketId, escalationId) {
        const modal = document.getElementById('rejectEscalationModal');
        document.getElementById('rejectEscalationNotesTextarea').value = '';
        
        document.getElementById('confirmRejectEscalation').onclick = function() {
            markEscalationAsRejected(ticketId, escalationId);
        };
        
        modal.classList.remove('hidden');
    }

    function closeRejectEscalationModal() {
        document.getElementById('rejectEscalationModal').classList.add('hidden');
    }

    function markEscalationAsRejected(ticketId, escalationId) {
        const notes = document.getElementById('rejectEscalationNotesTextarea').value.trim();
        
        if (!notes || notes.length < 10) {
            alert('Please provide a detailed reason for rejection (minimum 10 characters).');
            return;
        }
        
        fetch(`/admin/tickets/${ticketId}/escalations/${escalationId}/reject`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': '{{ csrf_token() }}'
            },
            body: JSON.stringify({ notes: notes })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                closeRejectEscalationModal();
                alert(data.message);
                loadTicketDetails(ticketId);
            } else {
                alert(data.message || 'Error rejecting escalation');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error rejecting escalation. Please try again.');
        });
    }
